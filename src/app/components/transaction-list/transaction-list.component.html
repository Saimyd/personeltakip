<div class="card shadow-sm border-0 h-100 overflow-hidden" style="min-height: 500px;">
    <!-- Sticky Header with Search -->
    <div class="card-header bg-white border-bottom py-3 sticky-top z-index-10">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0 fw-bold text-dark">İşlem Geçmişi</h5>
            <span class="badge bg-light text-secondary rounded-pill border">{{ budgetService.transactions().length }}
                kayıt</span>
        </div>

        <!-- Search Input -->
        <div class="position-relative">
            <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
            <input type="text" class="form-control form-control-lg bg-light border-0 ps-5 fs-6"
                placeholder="İşlem veya kategori ara..." [value]="searchTerm()"
                (input)="searchTerm.set($any($event.target).value)">
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="card-body p-0 custom-scrollbar overflow-auto" style="max-height: 600px;">

        <!-- List Container -->
        <div *ngIf="groupedTransactions().length > 0; else noData">

            <!-- Date Groups -->
            <div *ngFor="let group of groupedTransactions()" class="mb-0">

                <!-- Date Header -->
                <div class="px-4 py-2 bg-light-subtle d-flex align-items-center border-bottom border-light">
                    <small class="text-uppercase fw-bold text-muted" style="font-size: 0.75rem; letter-spacing: 0.5px;">
                        {{ getSemanticDate(group.date) }}
                    </small>
                </div>

                <!-- Transactions -->
                <div class="list-group list-group-flush">
                    <div *ngFor="let t of group.items"
                        class="list-group-item list-group-item-action border-0 px-4 py-3 cursor-pointer transaction-item d-flex align-items-center justify-content-between"
                        (click)="editState.startEdit(t)">

                        <!-- Left: Icon & Info -->
                        <div class="d-flex align-items-center gap-3">
                            <!-- Icon -->
                            <div class="icon-box rounded-4 d-flex align-items-center justify-content-center text-white shadow-sm"
                                [ngClass]="'bg-' + getCategoryColor(t.category, t.description)"
                                style="width: 48px; height: 48px; background-image: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(0,0,0,0.05));">
                                <i class="bi fs-5" [ngClass]="getCategoryIcon(t.category, t.description)"></i>
                            </div>

                            <!-- Texts -->
                            <div class="d-flex flex-column">
                                <h6 class="mb-0 fw-bold text-dark">{{ t.description }}</h6>
                                <span class="small text-muted">{{ getCategoryName(t.category) }}</span>
                            </div>
                        </div>

                        <!-- Right: Amount & Delete -->
                        <div class="d-flex align-items-center gap-4">
                            <div class="text-end">
                                <h6 class="mb-0 fw-bold" [class.text-success]="t.type === 'income'"
                                    [class.text-danger]="t.type === 'expense'">
                                    {{ t.type === 'income' ? '+' : '-' }} {{ t.amount |
                                    currency:'TRY':'symbol-narrow':'1.0-0' }}
                                </h6>
                                <small class="text-muted" style="font-size: 0.7rem;">{{ t.date | date:'shortTime'
                                    }}</small>
                            </div>

                            <!-- Delete Button (Visible on Hover) -->
                            <button class="btn btn-icon-sm btn-light text-danger rounded-circle shadow-sm delete-btn"
                                (click)="$event.stopPropagation(); budgetService.deleteTransaction(t.id)" title="Sil">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <ng-template #noData>
            <div class="d-flex flex-column align-items-center justify-content-center h-100 py-5 text-center fade-in-up">
                <div class="bg-light rounded-circle p-4 mb-3">
                    <i class="bi bi-search text-secondary opacity-50 display-6"></i>
                </div>
                <h6 class="text-dark fw-bold">Sonuç Bulunamadı</h6>
                <p class="text-muted small mb-0 px-4">Aradığınız kriterlere uygun işlem yok veya listeniz henüz boş.</p>
            </div>
        </ng-template>
    </div>
</div>